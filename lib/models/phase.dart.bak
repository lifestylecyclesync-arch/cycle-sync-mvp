/// Data model for menstrual cycle phases based on Dr. Mindy Pelz's cycle syncing framework.
/// 
/// THIS IS THE SINGLE SOURCE OF TRUTH for all cycle phase predictions:
/// - Hormonal phases (from cycle_utils.getCyclePhase)
/// - Workout phases (Power, Manifestation, Nurture)
/// - Nutrition approaches (Ketobiotic, Hormone Feasting)
/// - Fasting recommendations
/// - Lifestyle phases
/// 
/// IMPORTANT: Phase boundaries are defined by DAY-BASED LOGIC ONLY in getCyclePhase().
/// Do NOT use percentages for phase predictions - they are inaccurate and cause misalignment.
/// Use getCyclePhase() function with actual calendar dates.
class Phase {
  final String name;
  final String emoji;
  final String description;
  final String lifestylePhase; // Power / Manifestation / Nurture
  final String hormonalPhase; // Menstrual / Follicular / Ovulation / Early Luteal / Luteal
  final String hormonalState; // e.g., "Low E, Low P", "Rising E", "Peak E (LH Surge)"
  final String dietType; // e.g., "Low-Carb Gut-Support", "High-Carb Hormone Support"
  final String workoutType; // e.g., "gentle strength / restorative", "High-intensity, strength-focused"
  final String fastingDuration; // e.g., "IF 13h", "IF 15h", "no fasting"
  final String guidanceNotes; // Detailed lifestyle and wellness notes
  final String workoutEmoji; // Emoji for the workout type
  final String nutritionEmoji; // Emoji for the nutrition approach
  
  // NOTE: Percentages removed. Use getCyclePhase() with actual dates for accurate phase prediction.

  const Phase({
    required this.name,
    required this.emoji,
    required this.description,
    required this.lifestylePhase,
    required this.hormonalPhase,
    required this.hormonalState,
    required this.dietType,
    required this.workoutType,
    required this.fastingDuration,
    required this.guidanceNotes,
    this.workoutEmoji = 'üèãÔ∏è',
    this.nutritionEmoji = 'üçΩÔ∏è',
  });

  /// Get next phase in the cycle.
  String? get nextPhase {
    final phaseIndex = CyclePhases.phases.indexOf(this);
    if (phaseIndex >= 0 && phaseIndex < CyclePhases.phases.length - 1) {
      return CyclePhases.phases[phaseIndex + 1].name;
    }
    return 'Menstrual'; // Loop back to menstrual phase
  }
}

/// Static list of phases based on Dr. Mindy Pelz's cycle syncing framework.
/// THIS IS THE SINGLE SOURCE OF TRUTH for all phase predictions.
/// 
/// PHASE BOUNDARIES (Day-Based, from getCyclePhase()):
/// - Menstrual:    Day 1 ‚Üí menstrualLength
/// - Follicular:   Day (menstrualLength + 1) ‚Üí (ovulationDay - 2)
/// - Ovulation:    Day (ovulationDay - 2) ‚Üí (ovulationDay + 2) [5-day Manifestation window]
/// 
/// COMPREHENSIVE PHASES WITH LIFESTYLE, HORMONAL, WORKOUT, NUTRITION & FASTING DATA:
/// Source: Hormonal Phases & Lifestyle Syncing Table with all lifestyle recommendations
/// 
/// Day 1‚Äì(ML-1):              Power / Menstrual / Low E, Low P
/// Day ML:                    Power / Menstrual / Low E, Low P
/// Day (ML+1)‚Äì(ML+5):         Power / Follicular / Rising E
/// Day (ML+6)‚Äì(OD-2):         Manifestation / Follicular / Peak E (LH Surge)
/// Day (OD-1)‚Äì(OD+1):         Manifestation / Ovulation / Peak E (LH Surge)
/// Day (OD+2)‚Äì(OD+5):         Power / Early Luteal / Declining E, Rising P
/// Day (OD+6)‚ÄìCycleLength:    Nurture / Luteal / Low E, High P
class CyclePhases {
  static const List<Phase> phases = [
    Phase(
      name: 'Menstrual (Days 1 to ML-1)',
      emoji: 'ü©∏',
      description: 'Rest & Restore',
      lifestylePhase: 'Power',
      hormonalPhase: 'Menstrual',
      hormonalState: 'Low E, Low P',
      workoutEmoji: 'üí™',
      nutritionEmoji: 'ü•ó',
    ),
    Phase(
      name: 'Menstrual (Day ML)',
      emoji: 'ü©∏',
      description: 'Prepare for Follicular',
      lifestylePhase: 'Power',
      hormonalPhase: 'Menstrual',
      hormonalState: 'Low E, Low P',
      dietType: 'Low‚ÄëCarb Gut‚ÄëSupport',
      workoutType: 'gentle strength / restorative',
      fastingDuration: 'IF 15h',
      guidanceNotes: 'Prepare body for follicular rise',
      workoutEmoji: 'üí™',
      nutritionEmoji: 'ü•ó',
    ),
    Phase(
      name: 'Follicular (Early)',
      emoji: 'üå±',
      description: 'Rising Energy',
      lifestylePhase: 'Power',
      hormonalPhase: 'Follicular',
      hormonalState: 'Rising E',
      dietType: 'Low‚ÄëCarb Gut‚ÄëSupport',
      workoutType: 'High‚Äëintensity, strength‚Äëfocused',
      fastingDuration: 'IF 17h',
      guidanceNotes: 'Energy rising ‚Ä¢ HIIT & sprints effective ‚Ä¢ Lean proteins ‚Ä¢ Great time to start new projects',
      workoutEmoji: 'üí™',
      nutritionEmoji: 'ü•ó',
    ),
    Phase(
      name: 'Follicular (Late)',
      emoji: 'üå±',
      description: 'Peak Confidence',
      lifestylePhase: 'Manifestation',
      hormonalPhase: 'Follicular',
      hormonalState: 'Peak E (LH Surge)',
      dietType: 'High‚ÄëCarb Hormone Support',
      workoutType: 'strength & resistance training',
      fastingDuration: 'IF 13h',
      guidanceNotes: 'Max intensity possible ‚Ä¢ Confident & social ‚Ä¢ Increase carbs ‚Ä¢ Nutrient absorption peaks ‚Ä¢ Celebrate this window',
      workoutEmoji: '‚ú®',
      nutritionEmoji: 'üç≤',
    ),
    Phase(
      name: 'Ovulation',
      emoji: '‚ú®',
      description: 'Peak Energy',
      lifestylePhase: 'Manifestation',
      hormonalPhase: 'Ovulation',
      hormonalState: 'Peak E (LH Surge)',
      dietType: 'High‚ÄëCarb Hormone Support',
      workoutType: 'strength & resistance training',
      fastingDuration: 'IF 13h',
      guidanceNotes: 'Max intensity possible ‚Ä¢ Confident & social ‚Ä¢ Increase carbs ‚Ä¢ Nutrient absorption peaks ‚Ä¢ Celebrate this window',
      workoutEmoji: '‚ú®',
      nutritionEmoji: 'üç≤',
    ),
    Phase(
      name: 'Early Luteal',
      emoji: 'üåô',
      description: 'Building Energy',
      lifestylePhase: 'Power',
      hormonalPhase: 'Early Luteal',
      hormonalState: 'Declining E, Rising P',
      dietType: 'Low‚ÄëCarb Gut‚ÄëSupport',
      workoutType: 'High‚Äëintensity, strength‚Äëfocused',
      fastingDuration: 'IF 15h',
      guidanceNotes: 'Moderate intensity ‚Ä¢ Build endurance ‚Ä¢ Transition meals ‚Ä¢ Maintain strength gained',
      workoutEmoji: 'üí™',
      nutritionEmoji: 'ü•ó',
    ),
    Phase(
      name: 'Luteal (Late)',
      emoji: 'üåô',
      description: 'Inward Focus',
      lifestylePhase: 'Nurture',
      hormonalPhase: 'Luteal',
      hormonalState: 'Low E, High P',
      dietType: 'High‚ÄëCarb Hormone Support',
      workoutType: 'restorative, low‚Äëimpact workouts',
      fastingDuration: 'no fasting',
      guidanceNotes: 'Gentle activity (yoga, walking) ‚Ä¢ Elevated metabolism = more calories ‚Ä¢ Eat 3x daily or when hungry ‚Ä¢ Self‚Äëcompassion meals ‚Ä¢ Support mood ‚Ä¢ Prioritize sleep',
      workoutEmoji: 'üå∏',
      nutritionEmoji: 'üç≤',
    ),
  ];

  /// Find phase by name.
  static Phase? findPhaseByName(String name) {
    try {
      return phases.firstWhere((phase) => phase.name == name);
    } catch (e) {
      return null;
    }
  }

  /// Find phase by workout type.
  static Phase? findPhaseByWorkoutType(String workoutType) {
    try {
      return phases.firstWhere((phase) => phase.workoutType.contains(workoutType));
    } catch (e) {
      return null;
    }
  }

  /// Find phase by diet type.
  static Phase? findPhaseByDietType(String dietType) {
    try {
      return phases.firstWhere((phase) => phase.dietType.contains(dietType));
    } catch (e) {
      return null;
    }
  }

  /// Find phase for a given cycle day.
  /// ‚ö†Ô∏è DEPRECATED: Use getCyclePhase() instead for accurate predictions!
  /// This method is no longer recommended due to percentage-based calculations.
  @Deprecated('Use getCyclePhase() from cycle_utils.dart instead')
  static Phase? findPhaseForDay(int dayOfCycle, int cycleLength) {
    // Not implemented - use getCyclePhase() instead
    return null;
  }

  /// Get all phase day ranges for a specific cycle length.
  /// ‚ö†Ô∏è DEPRECATED: Percentages should not be used for phase boundaries.
  /// Use getCyclePhase() with actual dates instead.
  @Deprecated('Use getCyclePhase() from cycle_utils.dart instead')
  static Map<String, String> getAllPhaseRanges(int cycleLength) {
    return {}; // Not implemented - use getCyclePhase() instead
  }
}
